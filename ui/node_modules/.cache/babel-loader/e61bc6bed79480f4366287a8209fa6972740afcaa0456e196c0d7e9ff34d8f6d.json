{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useApi}from'../context/ApiContext';import{LineChart,Line,XAxis,YAxis,CartesianGrid,Tooltip,ResponsiveContainer,BarChart,Bar}from'recharts';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Dashboard=()=>{const{getStatus,getTenants,loading,error}=useApi();const[status,setStatus]=useState(null);const[tenants,setTenants]=useState([]);const[metrics,setMetrics]=useState({reconcileCount:[],tenantHealth:[]});useEffect(()=>{const fetchData=async()=>{try{const[statusData,tenantsData]=await Promise.all([getStatus(),getTenants()]);setStatus(statusData);setTenants(tenantsData.tenants||[]);// Mock metrics data\nsetMetrics({reconcileCount:[{time:'00:00',count:12},{time:'04:00',count:15},{time:'08:00',count:18},{time:'12:00',count:22},{time:'16:00',count:19},{time:'20:00',count:16}],tenantHealth:[{name:'Healthy',count:tenants.filter(t=>t.status==='active').length},{name:'Warning',count:tenants.filter(t=>t.spike_detected).length},{name:'Error',count:0}]});}catch(err){console.error('Failed to fetch dashboard data:',err);}};fetchData();const interval=setInterval(fetchData,60000);// Refresh every minute\nreturn()=>clearInterval(interval);},[getStatus,getTenants,tenants.length]);if(loading&&!status){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500\"})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-800 dark:text-red-200\",children:[\"Error: \",error]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 dark:text-white\",children:\"System Overview\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-gray-600 dark:text-gray-300\",children:\"Monitor your Mimir limit optimizer performance and tenant health\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\",children:[/*#__PURE__*/_jsx(StatusCard,{title:\"Mode\",value:(status===null||status===void 0?void 0:status.mode)||'Unknown',icon:\"\\u2699\\uFE0F\",color:(status===null||status===void 0?void 0:status.mode)==='prod'?'green':'blue'}),/*#__PURE__*/_jsx(StatusCard,{title:\"Total Tenants\",value:(status===null||status===void 0?void 0:status.total_tenants)||0,icon:\"\\uD83D\\uDC65\",color:\"blue\"}),/*#__PURE__*/_jsx(StatusCard,{title:\"Reconcile Count\",value:(status===null||status===void 0?void 0:status.reconcile_count)||0,icon:\"\\uD83D\\uDD04\",color:\"purple\"}),/*#__PURE__*/_jsx(StatusCard,{title:\"Circuit Breaker\",value:(status===null||status===void 0?void 0:status.circuit_breaker_state)||'Unknown',icon:\"\\uD83D\\uDD0C\",color:(status===null||status===void 0?void 0:status.circuit_breaker_state)==='CLOSED'?'green':'red'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\",children:\"Reconcile Activity (24h)\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:300,children:/*#__PURE__*/_jsxs(LineChart,{data:metrics.reconcileCount,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"time\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"count\",stroke:\"#3b82f6\",strokeWidth:2})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\",children:\"Tenant Health Status\"}),/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:300,children:/*#__PURE__*/_jsxs(BarChart,{data:metrics.tenantHealth,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"name\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"count\",fill:\"#3b82f6\"})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:\"Recent Activity\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:tenants.slice(0,5).map((tenant,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full \".concat(tenant.spike_detected?'bg-red-400':'bg-green-400')}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-900 dark:text-white\",children:tenant.id}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-500\",children:[tenant.ingestion_rate,\" samples/sec\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:new Date(tenant.last_config_change).toLocaleTimeString()})]},index))})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-4 border-b border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:\"Component Health\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\",children:(status===null||status===void 0?void 0:status.components_health)&&Object.entries(status.components_health).map(_ref=>{let[component,healthy]=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 rounded-full \".concat(healthy?'bg-green-400':'bg-red-400')}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm capitalize text-gray-700 dark:text-gray-300\",children:component.replace('_',' ')})]},component);})})})]})]});};const StatusCard=_ref2=>{let{title,value,icon,color}=_ref2;const colorClasses={blue:'bg-blue-500',green:'bg-green-500',red:'bg-red-500',purple:'bg-purple-500',yellow:'bg-yellow-500'};return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-3 rounded-full \".concat(colorClasses[color],\" bg-opacity-10\"),children:/*#__PURE__*/_jsx(\"span\",{className:\"text-2xl\",children:icon})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600 dark:text-gray-400\",children:title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-semibold text-gray-900 dark:text-white\",children:value})]})]})});};export default Dashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}